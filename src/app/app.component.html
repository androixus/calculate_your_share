<div class="container">

  <header class="header">
    <div class="subtitle">
      <span class="badge" [class.stopped]="gameStopped()">
        {{ gameStopped() ? 'Stopped' : 'Running' }}
      </span>
    </div>
  </header>

  <!-- Commands -->
  <div class="commands">
    <button class="btn warn" (click)="onNewGame()">New Game</button>
    <button class="btn" (click)="onAddPlayer()">add_player</button>
    <button class="btn" (click)="onStopGame()">stop_game</button>
    <button class="btn primary" (click)="onTotalCost()">total_cost</button>
  </div>

  <!-- Totals -->
  <div class="totals">
    <div><strong>Total Minutes:</strong> {{ totalPlayedMinutes() }}</div>
    <div *ngIf="totalCost() !== null"><strong>Total Cost:</strong> {{ totalCost() | number:'1.2-2' }}</div>
  </div>

  <!-- Players list -->
  <section class="list" [class.has-cost]="totalCost() !== null">
    <div class="list-header">
      <div class="col name">Player</div>
      <div class="col joined">Joined</div>
      <div class="col left">Left</div>
      <div class="col minutes">Minutes</div>
      <div class="col cost" *ngIf="totalCost() !== null">Cost</div>
      <div class="col action">Action</div>
    </div>

    <div class="row" *ngFor="let p of players(); trackBy: trackByName">
      <div class="col name">{{ p.name }}</div>

      <div class="col joined">
        <ng-container *ngIf="p.currentStart; else dashJoin">
          {{ p.currentStart | date:'HH:mm' }}
        </ng-container>
        <ng-template #dashJoin>—</ng-template>
      </div>

      <div class="col left">
        <ng-container *ngIf="p.lastLeaveAt; else dashLeft">
          {{ p.lastLeaveAt | date:'HH:mm' }}
        </ng-container>
        <ng-template #dashLeft>—</ng-template>
      </div>

      <div class="col minutes">{{ displayedMinutes(p) }}</div>

      <div class="col cost" *ngIf="totalCost() !== null">
        {{ shareFor(p) ?? 0 | number:'1.2-2' }}
      </div>

      <div class="col action">
        <button class="btn small"
                [disabled]="p.status !== 'playing'"
                (click)="onLeave(p)">leave</button>
      </div>
    </div>

    <div class="empty" *ngIf="players().length === 0">
      No players yet. Use <em>add_player</em> to add someone.
    </div>
  </section>

  <footer class="footnote" *ngIf="totalCost() !== null">
    <p>
      Costs are split proportionally by total minutes per player. Minutes are rounded up per session.
    </p>
  </footer>
</div>
